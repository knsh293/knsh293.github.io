<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”é›å…”åŒç± å¤§ä½œæˆ°ğŸ‡</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #FF9800;
            --accent-color: #2196F3;
            --danger-color: #f44336;
            --bg-color: #e3f2fd;
            --card-bg: #fff;
            --text-main: #37474f;
            --wood-light: #deb887;
            --wood-dark: #8b4513;
            --num-box-bg: #e0e0e0;
            --num-box-text: #000;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 5px; /* ç¸®æ¸›é‚Šè·ä»¥é©æ‡‰ 16:9 */
            color: var(--text-main);
            overflow-x: hidden; /* é¿å…æ°´å¹³æ²å‹• */
        }

        h1 {
            color: #455a64;
            margin: 5px 0; /* ç¸®æ¸›æ¨™é¡Œç•™ç™½ */
            font-size: 1.6rem; /* ç¨å¾®ç¸®å°å­—é«” */
            text-align: center;
        }

        /* --- å„€è¡¨æ¿å®¹å™¨ (æ›´ç·Šæ¹Š) --- */
        .dashboard-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 1100px; /* æ‹‰å¯¬ä»¥é©æ‡‰å¯¬è¢å¹• */
            margin-bottom: 10px;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* æœ¨æ¿æ¨£å¼ (è¼•é‡åŒ–) */
        .wood-board {
            background-color: var(--wood-light);
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.03) 10px, rgba(0,0,0,0.03) 20px);
            border: 5px solid var(--wood-dark);
            border-radius: 12px;
            padding: 10px 20px; /* æ¸›å°‘å…§è· */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            gap: 8px; /* æ¸›å°‘è¡Œè· */
            min-width: 320px;
            position: relative;
        }

        /* ç§»é™¤äº† ::after èˆ‡ ::before (é‡˜å­) */

        .info-row {
            font-size: 1.2rem;
            font-weight: bold;
            color: #5d4037;
            display: flex;
            align-items: center;
            justify-content: flex-start; 
            gap: 15px; 
            border-bottom: 1px dashed rgba(139, 69, 19, 0.3);
            padding-bottom: 4px;
        }
        .info-row:last-child { border-bottom: none; padding-bottom: 0; }

        .info-label {
            font-size: 1.1rem;
            opacity: 0.9;
            width: 70px; /* å›ºå®šå¯¬åº¦ */
            text-align: justify;
            text-align-last: justify; 
            white-space: nowrap;
        }

        .num-box {
            background-color: var(--num-box-bg);
            color: var(--num-box-text);
            padding: 1px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.3rem; /* ç¨å¾®ç¸®å°æ•¸å­— */
            border: 1px solid #bdbdbd;
        }

        /* æ¼«ç•«å°è©±æ¡† (æ›´æ‰å¹³) */
        .speech-bubble {
            background: white;
            padding: 10px 20px;
            border-radius: 15px;
            position: relative;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            max-width: 250px;
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
            text-align: center;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70px; /* é™ä½é«˜åº¦ */
            white-space: pre-line; 
            line-height: 1.3;
        }

        .speech-bubble::before {
            content: ""; position: absolute; left: -24px; top: 50%; transform: translateY(-50%);
            border: 12px solid transparent; border-right: 12px solid #333;
        }
        .speech-bubble::after {
            content: ""; position: absolute; left: -18px; top: 50%; transform: translateY(-50%);
            border: 9px solid transparent; border-right: 9px solid white;
        }

        /* --- éŠæˆ²ä¸»å€åŸŸ --- */
        .game-area {
            display: flex; gap: 10px; width: 100%; max-width: 1200px; /* æ‹‰å¯¬ */
            align-items: stretch; flex-wrap: wrap; justify-content: center;
        }

        /* å·¦å´æ§åˆ¶ */
        .side-panel {
            background: var(--card-bg); padding: 10px; border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; gap: 10px;
            min-width: 130px; justify-content: center;
        }
        .control-group { text-align: center; }

        .btn-circle {
            width: 40px; height: 40px; /* ç¸®å°æŒ‰éˆ• */
            border-radius: 50%; border: none;
            font-size: 1.2rem; font-weight: bold; cursor: pointer; margin: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .btn-circle:active { transform: scale(0.9); }
        .btn-plus { background: var(--primary-color); color: white; }
        .btn-minus { background: var(--secondary-color); color: white; }

        .btn-text {
            display: block; width: 100%; padding: 8px 5px; margin-top: 3px;
            border: none; border-radius: 5px; background: #ddd; cursor: pointer;
            font-weight: bold; font-size: 0.9rem;
        }
        .btn-text:hover { background: #ccc; }

        /* ä¸­å¤®æŸµæ¬„ */
        .fence-container {
            flex: 2; min-width: 350px; background: #8d6e63; padding: 10px;
            border-radius: 12px; border: 6px solid #5d4037;
            display: flex; flex-direction: column; gap: 8px; position: relative;
        }
        .fence-row {
            flex: 1; background: rgba(255,255,255,0.9); border-radius: 8px;
            padding: 8px; display: flex; flex-wrap: wrap; align-content: center;
            gap: 2px; min-height: 100px; /* ç¨å¾®é™ä½æœ€å°é«˜åº¦ */
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        .animal-item {
            font-size: 2.5rem; /* ç¨å¾®ç¸®å°å‹•ç‰©åœ–ç¤º */
            animation: bounceIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1; user-select: none; width: 45px; text-align: center;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        .btn-clear-abs {
            position: absolute; top: -15px; right: -5px; background: var(--danger-color);
            color: white; border: 2px solid white; padding: 4px 12px;
            border-radius: 20px; cursor: pointer; box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            z-index: 10; font-weight: bold; font-size: 0.9rem;
        }

        /* å³å´äº¤æ›å€ */
        .swap-panel {
            display: flex; flex-direction: column; justify-content: center;
            gap: 15px; min-width: 160px;
        }
        .btn-swap {
            padding: 10px 8px; border: none; border-radius: 10px;
            cursor: pointer; font-size: 0.95rem; font-weight: bold;
            display: flex; flex-direction: column; align-items: center; gap: 3px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2); transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn-swap:active { transform: translateY(3px); box-shadow: 0 0 0 rgba(0,0,0,0.2); }

        .swap-c-to-r { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border: 2px solid #ff9800; color: #e65100; }
        .swap-r-to-c { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border: 2px solid #4caf50; color: #1b5e20; }
        .swap-icon { font-size: 1.6rem; }
        .swap-tag { background: rgba(0,0,0,0.1); padding: 1px 6px; border-radius: 8px; font-size: 0.85rem; }

        /* ä¸‹æ–¹ä½œç­”å€ (æ›´ç·Šæ¹Š) */
        .answer-area {
            background: white; margin-top: 15px; padding: 10px 30px;
            border-radius: 40px; box-shadow: 0 -3px 10px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 20px;
        }
        .answer-group { font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .answer-display {
            background: var(--num-box-bg); color: var(--num-box-text);
            padding: 4px 0; border-radius: 5px; font-family: 'Courier New', monospace;
            font-weight: bold; font-size: 1.6rem; width: 65px; text-align: center;
            display: inline-block; box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 1px solid #bdbdbd;
        }
        .btn-submit {
            background: var(--accent-color); color: white; border: none;
            padding: 8px 30px; font-size: 1.2rem; border-radius: 25px;
            cursor: pointer; box-shadow: 0 3px 8px rgba(33, 150, 243, 0.3); font-weight: bold;
        }

        /* æµ®å‹•é›²æœµç‰¹æ•ˆ */
        .floating-cloud {
            position: absolute; background: white; color: #333;
            border: 2px solid #333; border-radius: 15px; padding: 6px 10px;
            font-weight: bold; font-size: 1rem; pointer-events: none; z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); white-space: pre; text-align: center; line-height: 1.3;
        }
        .floating-cloud::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; margin-left: -8px;
            border-width: 8px 8px 0; border-style: solid; border-color: #333 transparent;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.8); opacity: 0; }
            20% { transform: translateY(-30px) scale(1.1); opacity: 1; }
            100% { transform: translateY(-80px) scale(0.9); opacity: 0; }
        }

        /* Overlay */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none;
            justify-content: center; align-items: center; z-index: 2000;
        }
        .feedback-card {
            background: white; padding: 40px; border-radius: 20px;
            text-align: center; animation: popIn 0.3s;
        }
        .btn-retry, .btn-play-again {
            background: var(--primary-color); color: white; border:none;
            padding:10px 20px; border-radius:8px; margin:5px; cursor:pointer; font-size: 1.1rem;
        }
        .btn-retry { background: #757575; }

    </style>
</head>
<body>

    <h1>ğŸ”é›å…”åŒç± å¤§ä½œæˆ°ğŸ‡</h1>

    <div class="dashboard-container">
        
        <div class="wood-board">
            <div class="info-row">
                <span class="info-label">ç›®æ¨™</span>
                <span>
                    <span class="num-box" id="targetHead">0</span> å€‹é ­ / 
                    <span class="num-box" id="targetLeg">0</span> éš»è…³
                </span>
            </div>

            <div class="info-row">
                <span class="info-label">ç›®å‰æœ‰</span>
                <span>
                     <span class="num-box" id="currentHead">0</span> å€‹é ­ / 
                    <span class="num-box" id="currentLeg">0</span> éš»è…³
                </span>
            </div>
        </div>

        <div class="speech-bubble" id="statusBubble">
            è«‹é–‹å§‹æ”¾å…¥å‹•ç‰©...
        </div>

    </div>

    <div class="game-area">
        
        <div class="side-panel">
            <div class="control-group">
                <div style="font-size: 2rem;">ğŸ”</div>
                <div>
                    <button class="btn-circle btn-plus" onclick="updateAnimals('chicken', 1)">+</button>
                    <button class="btn-circle btn-minus" onclick="updateAnimals('chicken', -1)">-</button>
                </div>
                <button class="btn-text" onclick="fillAll('chicken')">å…¨éƒ¨æ”¾é›</button>
            </div>
            <hr style="width:80%; border:1px dashed #ccc;">
            <div class="control-group">
                <div style="font-size: 2rem;">ğŸ‡</div>
                <div>
                    <button class="btn-circle btn-plus" onclick="updateAnimals('rabbit', 1)">+</button>
                    <button class="btn-circle btn-minus" onclick="updateAnimals('rabbit', -1)">-</button>
                </div>
                <button class="btn-text" onclick="fillAll('rabbit')">å…¨éƒ¨æ”¾å…”</button>
            </div>
        </div>

        <div class="fence-container">
            <button class="btn-clear-abs" onclick="clearFence()">ğŸ—‘ï¸ æ¸…ç©º</button>
            
            <div class="fence-row" id="rowChicken"></div>
            
            <div class="fence-row" id="rowRabbit"></div>

            <div id="animationAnchor" style="position:absolute; top:50%; left:50%; width:0; height:0;"></div>
        </div>

        <div class="swap-panel">
            
            <button class="btn-swap swap-r-to-c" onclick="swapAnimal('r2c')">
                <span class="swap-icon">ğŸ‡ â¡ ğŸ”</span>
                <span>æŠŠå…”æ›æˆé›</span>
                <span class="swap-tag">è…³æ•¸ -2</span>
            </button>

            <button class="btn-swap swap-c-to-r" onclick="swapAnimal('c2r')">
                <span class="swap-icon">ğŸ” â¡ ğŸ‡</span>
                <span>æŠŠé›æ›æˆå…”</span>
                <span class="swap-tag">è…³æ•¸ +2</span>
            </button>

        </div>

    </div>

    <div class="answer-area">
        <div class="answer-group">
            é› <input type="text" id="ansChicken" class="answer-display" readonly value="0"> éš»
        </div>
        <div class="answer-group">
            å…” <input type="text" id="ansRabbit" class="answer-display" readonly value="0"> éš»
        </div>
        <button class="btn-submit" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
    </div>

    <div class="overlay" id="feedbackOverlay">
        <div class="feedback-card">
            <div id="fbIcon" style="font-size: 6rem;"></div>
            <h2 id="fbTitle" style="margin: 10px 0;"></h2>
            <p id="fbMsg" style="font-size: 1.2rem; color: #666;"></p>
            <div id="fbBtns"></div>
        </div>
    </div>

    <script>
        // --- éŠæˆ²è®Šæ•¸ ---
        let targetC = 0; // é¡Œç›®é›
        let targetR = 0; // é¡Œç›®å…”
        let targetTotal = 0; // é¡Œç›®ç¸½éš»æ•¸
        let targetLegs = 0; // é¡Œç›®ç¸½è…³æ•¸

        let currentC = 0; // æŸµæ¬„é›
        let currentR = 0; // æŸµæ¬„å…”

        // --- åˆå§‹åŒ– ---
        function initGame() {
            // éš¨æ©Ÿå‡ºé¡Œ (ç¸½æ•¸æ§åˆ¶åœ¨ 5-12 éš»)
            targetC = Math.floor(Math.random() * 8) + 1; 
            targetR = Math.floor(Math.random() * 8) + 1;
            targetTotal = targetC + targetR;
            targetLegs = (targetC * 2) + (targetR * 4);

            // æ›´æ–°é¡Œç›®é¢æ¿æ–‡å­—
            document.getElementById('targetHead').textContent = targetTotal;
            document.getElementById('targetLeg').textContent = targetLegs;

            // æ¸…ç©ºæŸµæ¬„
            currentC = 0;
            currentR = 0;
            renderAll();
            hideOverlay();
        }

        // --- æ ¸å¿ƒæ“ä½œé‚è¼¯ ---

        function updateAnimals(type, change) {
            if (change > 0 && (currentC + currentR) >= targetTotal) {
                showToast();
                return;
            }

            let prevC = currentC;
            let prevR = currentR;

            if (type === 'chicken') {
                currentC += change;
                if (currentC < 0) currentC = 0;
            } else {
                currentR += change;
                if (currentR < 0) currentR = 0;
            }

            let diffC = currentC - prevC;
            let diffR = currentR - prevR;
            if (diffC !== 0 || diffR !== 0) {
                renderAll();
                triggerCloudAnimation(diffC + diffR, (diffC*2 + diffR*4));
            }
        }

        function fillAll(type) {
            let prevC = currentC;
            let prevR = currentR;

            if (type === 'chicken') {
                currentC = targetTotal;
                currentR = 0;
            } else {
                currentC = 0;
                currentR = targetTotal;
            }

            renderAll();
            
            let diffC = currentC - prevC;
            let diffR = currentR - prevR;
            triggerCloudAnimation(diffC + diffR, (diffC*2 + diffR*4));
        }

        function swapAnimal(mode) {
            if (mode === 'c2r') {
                // é›æ›å…”
                if (currentC > 0) {
                    currentC--;
                    currentR++;
                    renderAll();
                    triggerCloudAnimation(0, 2); 
                } else {
                    showToast();
                }
            } else if (mode === 'r2c') {
                // å…”æ›é›
                if (currentR > 0) {
                    currentR--;
                    currentC++;
                    renderAll();
                    triggerCloudAnimation(0, -2);
                } else {
                    showToast();
                }
            }
        }

        function clearFence() {
            currentC = 0;
            currentR = 0;
            renderAll();
        }

        // --- ç•«é¢æ¸²æŸ“ ---
        function renderAll() {
            // æ¸²æŸ“é›
            const rowC = document.getElementById('rowChicken');
            rowC.innerHTML = '';
            for(let i=0; i<currentC; i++) {
                let span = document.createElement('div');
                span.className = 'animal-item';
                span.textContent = 'ğŸ”';
                rowC.appendChild(span);
            }

            // æ¸²æŸ“å…”
            const rowR = document.getElementById('rowRabbit');
            rowR.innerHTML = '';
            for(let i=0; i<currentR; i++) {
                let span = document.createElement('div');
                span.className = 'animal-item';
                span.textContent = 'ğŸ‡';
                rowR.appendChild(span);
            }

            // æ›´æ–°ç›®å‰ç‹€æ…‹
            let currentTotal = currentC + currentR;
            let currentLegs = (currentC * 2) + (currentR * 4);
            document.getElementById('currentHead').textContent = currentTotal;
            document.getElementById('currentLeg').textContent = currentLegs;

            // æ›´æ–°å°è©±æ¡†æ–‡å­— (å«æ–·è¡Œé‚è¼¯)
            const bubble = document.getElementById('statusBubble');
            if (currentTotal === 0) {
                bubble.textContent = "è«‹é–‹å§‹æ”¾å…¥å‹•ç‰©ï¼";
                bubble.style.color = "#333";
            } else if (currentTotal !== targetTotal) {
                bubble.textContent = "âš ï¸ é ­çš„æ•¸é‡é‚„ä¸å°å–”ï¼";
                bubble.style.color = "#f57f17"; 
            } else {
                // é ­æ•¸å°äº†ï¼Œæª¢æŸ¥è…³
                let legDiff = currentLegs - targetLegs;
                if (legDiff === 0) {
                    bubble.textContent = "âœ… å¤ªæ£’äº†ï¼\né ­å’Œè…³éƒ½æ­£ç¢ºï¼";
                    bubble.style.color = "#2e7d32"; 
                } else if (legDiff > 0) {
                    bubble.textContent = `âŒ å¤šäº† ${legDiff} éš»è…³\n(è©¦è©¦æŠŠå…”æ›é›?)`;
                    bubble.style.color = "#c62828";
                } else {
                    bubble.textContent = `âŒ å°‘äº† ${Math.abs(legDiff)} éš»è…³\n(è©¦è©¦æŠŠé›æ›å…”?)`;
                    bubble.style.color = "#c62828";
                }
            }

            // æ›´æ–°ä½œç­”å€
            document.getElementById('ansChicken').value = currentC;
            document.getElementById('ansRabbit').value = currentR;
        }

        // --- ç‰¹æ•ˆèˆ‡å›é¥‹ ---
        
        function triggerCloudAnimation(diffCount, diffLegs) {
            if (diffCount === 0 && diffLegs === 0) return;

            const anchor = document.getElementById('animationAnchor');
            const cloud = document.createElement('div');
            cloud.className = 'floating-cloud';
            
            let displayText = "";

            if (diffCount !== 0) {
                let animalSign = diffCount > 0 ? '+' : '';
                displayText += `å‹•ç‰© ${animalSign}${diffCount}`;
            }

            if (diffLegs !== 0) {
                if (displayText !== "") displayText += "\n"; 
                let legSign = diffLegs > 0 ? '+' : '';
                displayText += `è…³ ${legSign}${diffLegs}`;
            }

            cloud.textContent = displayText;
            
            if (diffLegs > 0) cloud.style.color = '#2e7d32'; 
            else if (diffLegs < 0) cloud.style.color = '#c62828';
            else cloud.style.color = '#333';

            let randX = Math.floor(Math.random()*40 - 20);
            cloud.style.transform = `translate(${randX}px, 0)`;

            anchor.appendChild(cloud);
            cloud.style.animation = "floatUp 1.5s ease-out forwards";
            setTimeout(() => cloud.remove(), 1500);
        }

        function showToast() {
            // è®“æœ¨æ¿èƒŒæ™¯é–ƒçˆä¸€ä¸‹
            const board = document.querySelector('.wood-board');
            board.style.backgroundColor = '#ffccbc';
            setTimeout(() => board.style.backgroundColor = '', 300);
        }

        // --- æª¢æŸ¥ç­”æ¡ˆ ---
        function checkAnswer() {
            const overlay = document.getElementById('feedbackOverlay');
            const icon = document.getElementById('fbIcon');
            const title = document.getElementById('fbTitle');
            const msg = document.getElementById('fbMsg');
            const btns = document.getElementById('fbBtns');

            overlay.style.display = 'flex';
            btns.innerHTML = '';

            let currentTotal = currentC + currentR;
            let currentLegs = (currentC * 2) + (currentR * 4);

            if (currentC === targetC && currentR === targetR) {
                icon.textContent = 'â­•';
                title.textContent = 'ç­”å°äº†ï¼å¤ªç¥å•¦ï¼';
                title.style.color = '#4CAF50';
                msg.textContent = `å®Œç¾çš„åˆ†é…ï¼š${currentC} éš»é›ï¼Œ${currentR} éš»å…”ã€‚`;
                
                const btnNext = document.createElement('button');
                btnNext.textContent = 'å†ç©ä¸€æ¬¡';
                btnNext.className = 'btn-play-again';
                btnNext.onclick = initGame;
                btns.appendChild(btnNext);
            } else {
                icon.textContent = 'âŒ';
                title.textContent = 'é‚„å·®ä¸€é»é»å–”ï¼';
                title.style.color = '#f44336';
                
                if (currentTotal !== targetTotal) {
                    msg.textContent = `é¡Œç›®èªªæ˜¯ ${targetTotal} å€‹é ­ï¼Œä½†ç›®å‰åªæœ‰ ${currentTotal} å€‹å–”ï¼`;
                } else {
                    let diff = targetLegs - currentLegs;
                    if (diff > 0) {
                        msg.textContent = `é ­æ•¸å°äº†ï¼Œä½†æ˜¯è…³å°‘äº† ${diff} éš»ï¼è©¦è©¦çœ‹æŠŠé›æ›æˆå…”å­ï¼Ÿ`;
                    } else {
                        msg.textContent = `é ­æ•¸å°äº†ï¼Œä½†æ˜¯è…³å¤šäº† ${Math.abs(diff)} éš»ï¼è©¦è©¦çœ‹æŠŠå…”å­æ›æˆé›ï¼Ÿ`;
                    }
                }

                const btnRetry = document.createElement('button');
                btnRetry.textContent = 'ç¹¼çºŒèª¿æ•´';
                btnRetry.className = 'btn-retry';
                btnRetry.onclick = hideOverlay;
                btns.appendChild(btnRetry);
            }
        }

        function hideOverlay() {
            document.getElementById('feedbackOverlay').style.display = 'none';
        }

        window.onload = initGame;
    </script>
</body>
</html>