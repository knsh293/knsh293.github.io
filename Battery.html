<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈõªË∑ØÊåëÊà∞ÔºöÈóñÈóúÊÖ∂Ë≥ÄÁâà</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bounce-subtle { animation: bounce-subtle 2s infinite; }
    </style>
</head>
<body class="bg-slate-50 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ‰øÆÊ≠£ÂæåÁöÑ Icon ÂÖÉ‰ª∂ÔºöÁ¢∫‰øùÊéõËºâÊôÇÁ´ãÂç≥Ëß∏Áôº‰∏ÄÊ¨°ÊéÉÊèè
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]); // Áï∂ÂêçÁ®±ÊîπËÆäÊôÇÈáçÊñ∞ËÆÄÂèñ
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const [items, setItems] = useState([]);
            const [connections, setConnections] = useState([]);
            const [score, setScore] = useState(null); 
            const [errorDetails, setErrorDetails] = useState([]);
            const [isEvaluating, setIsEvaluating] = useState(false);
            const [showLight, setShowLight] = useState(false);
            const [toolMode, setToolMode] = useState('move'); 
            const [currentChallengeIdx, setCurrentChallengeIdx] = useState(0);
            const [hasFinishedCurrent, setHasFinishedCurrent] = useState(false);
            const [showFinalCertificate, setShowFinalCertificate] = useState(false);
            
            const [interactionMode, setInteractionMode] = useState(null); 
            const [activeId, setActiveId] = useState(null);
            const [currentPath, setCurrentPath] = useState([]);
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
            
            const svgRef = useRef(null);

            const challenges = [
                {
                    id: 'series',
                    title: "Á¨¨‰∏ÄÈóúÔºöÁáàÊ≥°‰∏≤ËÅØ",
                    instruction: "‰ªªÂãôÔºöÁµÑÂá∫‰∏ÄÂÄã 2 ÂÄãÁáàÊ≥°‰∏≤ËÅØ 1 È°ÜÈõªÊ±†ÁöÑÈõªË∑Ø",
                    targetBulbs: 2,
                    targetBatteries: 1,
                    type: 'series'
                },
                {
                    id: 'parallel',
                    title: "Á¨¨‰∫åÈóúÔºöÁáàÊ≥°‰∏¶ËÅØ",
                    instruction: "‰ªªÂãôÔºöÁµÑÂá∫‰∏ÄÂÄã 2 ÂÄãÁáàÊ≥°‰∏¶ËÅØ 1 È°ÜÈõªÊ±†ÁöÑÈõªË∑Ø",
                    targetBulbs: 2,
                    targetBatteries: 1,
                    type: 'parallel'
                }
            ];

            const challenge = challenges[currentChallengeIdx];

            // ‰øÆÊ≠£ÈáçÈªû 1ÔºöÂ∞á items Âä†ÂÖ•Áõ£ËÅΩÈô£ÂàóÔºå‰øùË≠âÊñ∞ÂÖÉ‰ª∂Áî¢ÁîüÊôÇ Icon ÊúÉË¢´ÂàùÂßãÂåñ
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [toolMode, items, connections, score, showFinalCertificate, currentChallengeIdx]);

            const addItem = (type) => {
                if (hasFinishedCurrent) return;
                setShowLight(false);
                setScore(null);
                const newItem = {
                    id: Math.random().toString(36).substr(2, 9),
                    type,
                    x: 150 + Math.random() * 100,
                    y: 150 + Math.random() * 100,
                    width: type === 'battery' ? 180 : 100,
                    height: type === 'battery' ? 80 : 155,
                    ports: type === 'battery' 
                        ? [
                            { id: 'neg', offset: { x: 10, y: 40 }, radius: 30 }, 
                            { id: 'pos', offset: { x: 170, y: 40 }, radius: 30 } 
                          ]
                        : [
                            { id: 'side', offset: { x: 50, y: 110 }, radius: 24 }, 
                            { id: 'bottom', offset: { x: 50, y: 150}, radius: 30 } 
                          ]
                };
                setItems(prev => [...prev, newItem]);
            };

            const getSVGCoords = (e) => {
                const svg = svgRef.current;
                if (!svg) return { x: 0, y: 0 };
                const rect = svg.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return { x: clientX - rect.left, y: clientY - rect.top };
            };

            const getPortAt = (coords) => {
                for (const item of items) {
                    for (const port of item.ports) {
                        const px = item.x + port.offset.x;
                        const py = item.y + port.offset.y;
                        const dist = Math.sqrt((px - coords.x) ** 2 + (py - coords.y) ** 2);
                        if (dist < port.radius) return { itemId: item.id, portId: port.id };
                    }
                }
                return null;
            };

            const handleStart = (e) => {
                if (isEvaluating || hasFinishedCurrent) return;
                const coords = getSVGCoords(e);
                
                if (toolMode === 'eraser') {
                    setConnections(prev => prev.filter(conn => 
                        !conn.pathPoints.some(p => Math.sqrt((p.x - coords.x)**2 + (p.y - coords.y)**2) < 20)
                    ));
                    return;
                }

                const clickedItem = [...items].reverse().find(item => 
                    coords.x >= item.x && coords.x <= item.x + item.width &&
                    coords.y >= item.y && coords.y <= item.y + item.height
                );

                if (toolMode === 'move' && clickedItem) {
                    setInteractionMode('dragging');
                    setActiveId(clickedItem.id);
                    setDragOffset({ x: coords.x - clickedItem.x, y: coords.y - clickedItem.y });
                } else if (toolMode === 'pencil') {
                    setInteractionMode('drawing');
                    setCurrentPath([coords]);
                }
            };

            const handleMove = (e) => {
                if (!interactionMode) return;
                const coords = getSVGCoords(e);
                if (interactionMode === 'drawing') {
                    setCurrentPath(prev => [...prev, coords]);
                } else if (interactionMode === 'dragging') {
                    setItems(prev => prev.map(item => 
                        item.id === activeId ? { ...item, x: coords.x - dragOffset.x, y: coords.y - dragOffset.y } : item
                    ));
                }
            };

            const handleEnd = () => {
                if (interactionMode === 'drawing' && currentPath.length > 2) {
                    const startPort = getPortAt(currentPath[0]);
                    const endPort = getPortAt(currentPath[currentPath.length - 1]);
                    if (startPort || endPort) {
                        setConnections(prev => [...prev, {
                            id: `c-${Date.now()}`,
                            from: startPort,
                            to: endPort,
                            pathPoints: currentPath
                        }]);
                    }
                }
                setInteractionMode(null); setActiveId(null); setCurrentPath([]);
            };

            const evaluateCircuit = () => {
                setIsEvaluating(true);
                const errors = [];
                
                setTimeout(() => {
                    const bulbs = items.filter(i => i.type === 'bulb');
                    const batteries = items.filter(i => i.type === 'battery');
                    
                    if (batteries.length !== challenge.targetBatteries) {
                        errors.push(`ÈõªÊ±†Êï∏ÈáèÊáâÁÇ∫ ${challenge.targetBatteries} ÂÄã`);
                    }
                    if (bulbs.length !== challenge.targetBulbs) {
                        errors.push(`ÁáàÊ≥°Êï∏ÈáèÊáâÁÇ∫ ${challenge.targetBulbs} ÂÄã`);
                    }

                    if (errors.length > 0) {
                        setScore('wrong');
                        setErrorDetails(errors);
                        setIsEvaluating(false);
                        return;
                    }

                    const battery = batteries[0];
                    const batteryPos = `${battery.id}-pos`;
                    const batteryNeg = `${battery.id}-neg`;

                    const wireAdj = new Map();
                    const addWireEdge = (u, v) => {
                        if (!wireAdj.has(u)) wireAdj.set(u, []);
                        if (!wireAdj.has(v)) wireAdj.set(v, []);
                        wireAdj.get(u).push(v);
                        wireAdj.get(v).push(u);
                    };

                    connections.forEach(c => {
                        if (c.from && c.to) {
                            addWireEdge(`${c.from.itemId}-${c.from.portId}`, `${c.to.itemId}-${c.to.portId}`);
                        }
                    });

                    const isConnectedByWire = (start, target) => {
                        if (start === target) return true;
                        const visited = new Set();
                        const queue = [start];
                        while(queue.length > 0) {
                            const curr = queue.shift();
                            if (curr === target) return true;
                            visited.add(curr);
                            (wireAdj.get(curr) || []).forEach(next => {
                                if (!visited.has(next)) queue.push(next);
                            });
                        }
                        return false;
                    };

                    // Áü≠Ë∑ØÊ™¢Êü•
                    if (isConnectedByWire(batteryPos, batteryNeg)) {
                        errors.push("Ë≠¶ÂëäÔºöÈõªË∑ØÁôºÁîüÁü≠Ë∑ØÔºÅÂ∞éÁ∑öÁõ¥Êé•ÈÄ£Êé•‰∫ÜÈõªÊ±†ÁöÑÊ≠£Ë≤†Ê•µ„ÄÇ");
                    }

                    const fullAdj = new Map();
                    const addEdge = (u, v) => {
                        if (!fullAdj.has(u)) fullAdj.set(u, []);
                        if (!fullAdj.has(v)) fullAdj.set(v, []);
                        fullAdj.get(u).push(v);
                        fullAdj.get(v).push(u);
                    };

                    bulbs.forEach(b => {
                        addEdge(`${b.id}-side`, `${b.id}-bottom`);
                    });

                    connections.forEach(c => {
                        if (c.from && c.to) {
                            addEdge(`${c.from.itemId}-${c.from.portId}`, `${c.to.itemId}-${c.to.portId}`);
                        }
                    });

                    if (challenge.type === 'series') {
                        const findSeriesLoop = (curr, target, visited, bulbsCrossed) => {
                            if (curr === target && bulbsCrossed.size === bulbs.length) return true;
                            visited.add(curr);
                            const neighbors = fullAdj.get(curr) || [];
                            for (const next of neighbors) {
                                const newBulbsCrossed = new Set(bulbsCrossed);
                                bulbs.forEach(b => {
                                    const isCrossing = (curr === `${b.id}-side` && next === `${b.id}-bottom`) || 
                                                     (curr === `${b.id}-bottom` && next === `${b.id}-side`);
                                    if (isCrossing) newBulbsCrossed.add(b.id);
                                });
                                if (!visited.has(next) || (next === target && visited.size > 2)) {
                                    if (findSeriesLoop(next, target, new Set(visited), newBulbsCrossed)) return true;
                                }
                            }
                            return false;
                        };

                        if (!findSeriesLoop(batteryPos, batteryNeg, new Set(), new Set())) {
                            errors.push("Êú™ÂΩ¢ÊàêÊ≠£Á¢∫ÁöÑ‰∏≤ËÅØËø¥Ë∑Ø„ÄÇË´ãÁ¢∫‰øùÊâÄÊúâÁµÑ‰ª∂È†≠Â∞æÁõ∏Êé•„ÄÇ");
                        }
                    } else {
                        let activeBulbCount = 0;
                        bulbs.forEach((b, idx) => {
                            const side = `${b.id}-side`;
                            const bottom = `${b.id}-bottom`;
                            const sideToPos = isConnectedByWire(side, batteryPos);
                            const sideToNeg = isConnectedByWire(side, batteryNeg);
                            const bottomToPos = isConnectedByWire(bottom, batteryPos);
                            const bottomToNeg = isConnectedByWire(bottom, batteryNeg);
                            
                            if ((sideToPos && bottomToNeg) || (sideToNeg && bottomToPos)) {
                                activeBulbCount++;
                            } else {
                                errors.push(`ÁáàÊ≥° ${idx + 1} Êú™Ê≠£Á¢∫ÈÄ£ÈÄöÔºàÈúÄÂêåÊôÇÈÄ£Êé•ÂÅ¥ÈÇäËàáÂ∫ïÈÉ®‰∏¶ÈÄöÂæÄÈõªÊ±†ÂÖ©Ê•µÔºâ„ÄÇ`);
                            }
                        });

                        if (activeBulbCount !== bulbs.length) {
                            errors.push("‰∏¶ËÅØ‰ªªÂãôÂ§±ÊïóÔºö‰∏¶ÈùûÊâÄÊúâÁáàÊ≥°ÈÉΩÂΩ¢Êàê‰∫ÜÁç®Á´ãÈÄöË∑Ø„ÄÇ");
                        }
                    }

                    if (errors.length === 0) {
                        setScore('correct');
                        setShowLight(true);
                        setHasFinishedCurrent(true);
                    } else {
                        setScore('wrong');
                        setShowLight(false);
                        setErrorDetails([...new Set(errors)]);
                    }
                    setIsEvaluating(false);
                }, 800);
            };

            const handleScoreConfirm = () => {
                setScore(null);
                if (currentChallengeIdx === challenges.length - 1 && hasFinishedCurrent) {
                    setTimeout(() => setShowFinalCertificate(true), 500);
                }
            };

            const goToNextChallenge = () => {
                setItems([]); setConnections([]); setScore(null); setShowLight(false); setErrorDetails([]);
                setHasFinishedCurrent(false);
                setCurrentChallengeIdx(prev => prev + 1);
            };

            const resetCurrentChallenge = () => {
                setItems([]); setConnections([]); setScore(null); setShowLight(false); setErrorDetails([]);
                setHasFinishedCurrent(false);
                setShowFinalCertificate(false);
            };

            return (
                <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800 select-none overflow-hidden relative">
                    {/* Header */}
                    <header className="bg-white border-b border-emerald-100 px-8 py-4 flex justify-between items-center shadow-sm z-30">
                        <div className="flex items-center gap-6">
                            <div className="flex items-center">
                                <div className={`p-2 rounded-lg ${showLight ? "bg-yellow-100" : "bg-emerald-50"}`}>
                                    <Icon name="zap" className={showLight ? "text-yellow-600 fill-yellow-500" : "text-emerald-400"} />
                                </div>
                                <div className="w-px h-8 bg-emerald-100 mx-4" />
                            </div>
                            <div className="flex flex-col">
                                <span className="text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-0.5">{challenge.title}</span>
                                <div className="text-slate-900 font-extrabold text-xl tracking-tight">
                                    {challenge.instruction.split('ÁáàÊ≥°').map((part, i, arr) => (
                                        <React.Fragment key={i}>
                                            {part}
                                            {i < arr.length - 1 && <span className={challenge.type === 'series' ? "text-emerald-600" : "text-orange-500"}>ÁáàÊ≥°{i===0 && challenge.type==='series'?'‰∏≤ËÅØ': i===0 && challenge.type==='parallel'?'‰∏¶ËÅØ':''}</span>}
                                        </React.Fragment>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="flex gap-3">
                            <button onClick={resetCurrentChallenge} className="p-2.5 text-slate-400 hover:text-red-500 transition-all bg-white rounded-xl border border-slate-200 hover:border-red-200">
                                <Icon name="rotate-ccw" size={20} />
                            </button>
                            <button 
                                onClick={evaluateCircuit} 
                                disabled={isEvaluating || hasFinishedCurrent} 
                                className="px-8 py-2.5 bg-emerald-600 text-white rounded-xl font-black shadow-md hover:bg-emerald-700 active:scale-95 transition-all disabled:opacity-50"
                            >
                                {isEvaluating ? "ÂàÜÊûê‰∏≠..." : "Êèê‰∫§Á≠îÊ°à"}
                            </button>
                        </div>
                    </header>

                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar Tools */}
                        <aside className="w-24 border-r border-emerald-50 flex flex-col items-center py-8 gap-8 bg-white shadow-sm">
                            <button onClick={() => addItem('battery')} disabled={hasFinishedCurrent} className="flex flex-col items-center gap-2 group disabled:opacity-30">
                                <div className="w-16 h-16 rounded-2xl border-2 border-slate-100 flex items-center justify-center bg-slate-50 group-hover:border-emerald-500 group-hover:bg-emerald-50 transition-all">
                                    <Icon name="battery" className="text-slate-600 group-hover:text-emerald-600" />
                                </div>
                                <span className="text-[11px] font-black text-slate-400 uppercase tracking-tighter">ÈõªÊ±†</span>
                            </button>
                            <button onClick={() => addItem('bulb')} disabled={hasFinishedCurrent} className="flex flex-col items-center gap-2 group disabled:opacity-30">
                                <div className="w-16 h-16 rounded-2xl border-2 border-slate-100 flex items-center justify-center bg-slate-50 group-hover:border-emerald-500 group-hover:bg-emerald-50 transition-all">
                                    <Icon name="lightbulb" className="text-slate-600 group-hover:text-emerald-600" />
                                </div>
                                <span className="text-[11px] font-black text-slate-400 uppercase tracking-tighter">ÁáàÊ≥°</span>
                            </button>
                            <div className="w-10 h-px bg-slate-100" />
                            <div className="flex flex-col gap-4">
                                <button onClick={() => setToolMode('move')} className={`p-3.5 rounded-xl transition-all ${toolMode === 'move' ? 'bg-emerald-600 text-white shadow-lg' : 'text-slate-400 hover:bg-emerald-50 hover:text-emerald-600'}`}>
                                    <Icon name="move" />
                                </button>
                                <button onClick={() => setToolMode('pencil')} className={`p-3.5 rounded-xl transition-all ${toolMode === 'pencil' ? 'bg-emerald-600 text-white shadow-lg' : 'text-slate-400 hover:bg-emerald-50 hover:text-emerald-600'}`}>
                                    <Icon name="pencil" />
                                </button>
                                <button onClick={() => setToolMode('eraser')} className={`p-3.5 rounded-xl transition-all ${toolMode === 'eraser' ? 'bg-emerald-600 text-white shadow-lg' : 'text-slate-400 hover:bg-emerald-50 hover:text-emerald-600'}`}>
                                    <Icon name="eraser" />
                                </button>
                            </div>
                        </aside>

                        {/* Lab Area */}
                        <main 
                            className="flex-1 relative bg-white touch-none overflow-hidden" 
                            onMouseDown={handleStart} onMouseMove={handleMove} onMouseUp={handleEnd}
                            onTouchStart={handleStart} onTouchMove={handleMove} onTouchEnd={handleEnd}
                        >
                            <div className="absolute inset-0 pointer-events-none opacity-[0.4]" style={{ backgroundImage: `linear-gradient(to right, #ecfdf5 1px, transparent 1px), linear-gradient(to bottom, #ecfdf5 1px, transparent 1px)`, backgroundSize: '40px 40px' }} />
                            
                            <svg ref={svgRef} className="absolute inset-0 w-full h-full pointer-events-none z-10">
                                {connections.map(conn => (
                                    <polyline 
                                        key={conn.id} 
                                        points={conn.pathPoints.map(p => `${p.x},${p.y}`).join(' ')} 
                                        fill="none" 
                                        stroke={showLight ? "#fbbf24" : "#475569"} 
                                        strokeWidth="5" 
                                        strokeLinecap="round" 
                                        strokeLinejoin="round" 
                                        className="transition-colors duration-700 drop-shadow-sm" 
                                    />
                                ))}
                                {interactionMode === 'drawing' && <polyline points={currentPath.map(p => `${p.x},${p.y}`).join(' ')} fill="none" stroke="#10b981" strokeWidth="3" strokeDasharray="6,6" opacity="0.5" />}
                            </svg>

                            {items.map(item => (
                                <div key={item.id} style={{ left: item.x, top: item.y, width: item.width, height: item.height }} className="absolute flex items-center justify-center group hover:z-20 transition-transform">
                                    {/* ‰øÆÊ≠£ÈáçÈªû 2 & 3Ôºö‰ΩøÁî® Icon ÂÖÉ‰ª∂‰∏¶ÂÑ™Âåñ CSS ÈÅéÊ∏° */}
                                    {toolMode === 'move' && !hasFinishedCurrent && (
                                        <button 
                                            onClick={() => setItems(prev => prev.filter(i => i.id !== item.id))} 
                                            className="absolute -top-3 -right-3 w-8 h-8 bg-white border border-red-100 text-red-500 rounded-full flex items-center justify-center shadow-md z-30 opacity-0 group-hover:opacity-100 hover:bg-red-500 hover:text-white transition-opacity duration-150 transform hover:scale-110"
                                        >
                                            <Icon name="trash-2" size={16} />
                                        </button>
                                    )}
                                    {item.type === 'battery' ? (
                                        <div className="relative pointer-events-none drop-shadow-md">
                                            <svg width="180" height="80" viewBox="0 0 180 80">
                                                <rect x="10" y="10" width="155" height="60" rx="6" fill="#1e293b" />
                                                <rect x="165" y="25" width="8" height="30" rx="2" fill="#94a3b8" />
                                                <rect x="145" y="10" width="15" height="60" fill="#facc15" fillOpacity="0.8" />
                                                <text x="35" y="48" fill="#ef4444" fontSize="32" fontWeight="900" textAnchor="middle">-</text>
                                                <text x="130" y="47" fill="#facc15" fontSize="24" fontWeight="900" textAnchor="middle">+</text>
                                            </svg>
                                        </div>
                                    ) : (
                                        <div className="relative pointer-events-none">
                                            {showLight && (
                                                <div className="absolute top-[5%] left-[-20%] w-[140%] h-[90%] z-0">
                                                    <div className="absolute inset-0 bg-yellow-400 blur-[35px] opacity-30 animate-pulse rounded-full" />
                                                    <div className="absolute inset-4 bg-yellow-300 blur-[20px] opacity-50 rounded-full" />
                                                </div>
                                            )}
                                            <svg width="100" height="155" viewBox="0 0 100 155" className="relative z-10 drop-shadow-md">
                                                <defs>
                                                    <radialGradient id="bulbGlass" cx="50%" cy="40%" r="50%">
                                                        <stop offset="0%" stopColor={showLight ? "#FFFDE7" : "#FFFFFF"} stopOpacity="0.9" />
                                                        <stop offset="100%" stopColor={showLight ? "#FFF9C4" : "#F1F5F9"} stopOpacity="0.6" />
                                                    </radialGradient>
                                                </defs>
                                                <path d="M 20 55 A 30 30 0 1 1 80 55 Q 80 85 68 95 L 32 95 Q 20 85 20 55" fill="url(#bulbGlass)" stroke={showLight ? "#FACC15" : "#E2E8F0"} strokeWidth="1.5" />
                                                <g opacity={showLight ? "1" : "0.4"}>
                                                    <path d="M 42 75 C 42 65, 58 65, 58 75" fill="none" stroke={showLight ? "#F59E0B" : "#64748B"} strokeWidth="1.5" strokeLinecap="round" className={showLight ? "animate-pulse" : ""} />
                                                </g>
                                                <rect x="32" y="95" width="36" height="32" rx="2" fill="#94A3B8" />
                                                <path d="M 38 127 L 62 127 Q 62 145 50 145 Q 38 145 38 127 Z" fill="#1E293B" />
                                                <circle cx="50" cy="140" r="7" fill="#475569" stroke="#334155" strokeWidth="0.5" />
                                            </svg>
                                        </div>
                                    )}
                                </div>
                            ))}

                            {hasFinishedCurrent && currentChallengeIdx < challenges.length - 1 && (
                                <div className="absolute bottom-10 right-10 z-40">
                                    <button onClick={goToNextChallenge} className="px-10 py-5 bg-emerald-600 text-white rounded-2xl font-black shadow-xl hover:bg-emerald-700 transition-all flex items-center gap-4 group hover:-translate-y-1">
                                        <span className="text-lg">ÊåëÊà∞‰∏ã‰∏ÄÈóú</span> 
                                        <Icon name="arrow-right" className="group-hover:translate-x-2 transition-transform" />
                                    </button>
                                </div>
                            )}
                        </main>
                    </div>

                    {/* Score Modal */}
                    {score && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50 p-6">
                            <div className="bg-white p-10 rounded-[32px] shadow-2xl max-w-sm w-full text-center border border-emerald-50">
                                {score === 'correct' ? (
                                    <>
                                        <div className="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-6">
                                            <Icon name="trophy" className="text-emerald-600" size={48} />
                                        </div>
                                        <h2 className="text-3xl font-black text-slate-900">Â§™Ê£í‰∫ÜÔºÅ</h2>
                                        <p className="text-slate-500 mt-3 font-medium">ÈõªË∑ØÈÄ£Êé•Ê≠£Á¢∫„ÄÇüí°</p>
                                        <button onClick={handleScoreConfirm} className="mt-8 w-full py-4 bg-emerald-600 text-white rounded-2xl font-black shadow-lg hover:bg-emerald-700 transition-colors">Ê™¢Ë¶ñÁµêÊûú</button>
                                    </>
                                ) : (
                                    <>
                                        <div className="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6">
                                            <Icon name="alert-circle" className="text-red-500" size={48} />
                                        </div>
                                        <h2 className="text-3xl font-black text-slate-900">ÈúÄË¶ÅË™øÊï¥</h2>
                                        <div className="text-slate-600 mt-4 text-sm space-y-3 text-left bg-slate-50 p-6 rounded-2xl border border-slate-100">
                                            <ul className="space-y-2">
                                                {errorDetails.map((err, i) => (
                                                    <li key={i} className="flex gap-2 items-start font-semibold">
                                                        <span className="mt-1.5 p-1 rounded-full bg-red-400 shrink-0" />{err}
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                        <button onClick={() => setScore(null)} className="mt-8 w-full py-4 bg-slate-800 text-white rounded-2xl font-black shadow-lg hover:bg-slate-900 transition-colors">ÈáçÊñ∞ÂòóË©¶</button>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Final Certificate */}
                    {showFinalCertificate && (
                        <div className="fixed inset-0 bg-emerald-900/80 backdrop-blur-xl flex items-center justify-center z-[100] p-6">
                            <div className="bg-white rounded-[40px] shadow-2xl border-8 border-yellow-400 relative p-12 text-center max-w-lg w-full">
                                <div className="relative mb-8">
                                    <div className="w-32 h-32 bg-gradient-to-tr from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center mx-auto border-4 border-white shadow-xl">
                                        <Icon name="trophy" className="text-white" size={64} />
                                    </div>
                                </div>
                                <h1 className="text-4xl font-black mb-4">Ê¶ÆË≠ΩË≠âÊõ∏</h1>
                                <p className="text-slate-600 font-bold mb-8">ÊÅ≠Âñú‰Ω†ÂÆåÊàêÁáàÊ≥°ÁöÑ‰∏≤ËÅØÂíå‰∏¶ËÅØÊåëÊà∞ÔºÅ</p>
                                <button onClick={() => window.location.reload()} className="px-12 py-4 bg-slate-900 text-white rounded-2xl font-black">ÂÜçÊ¨°ÊåëÊà∞</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>