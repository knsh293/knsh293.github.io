<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”é›å…”åŒç± å¤§ä½œæˆ°ğŸ‡</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #FF9800;
            --accent-color: #2196F3;
            --danger-color: #f44336;
            --bg-color: #e3f2fd;
            --card-bg: #fff;
            --text-main: #37474f;
            --number-bg: #333;
            --number-text: #fff;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            color: var(--text-main);
        }

        h1 {
            color: #455a64;
            margin: 15px 0;
            font-size: 2rem;
            text-align: center;
        }

        /* --- é ‚éƒ¨å„€è¡¨æ¿å€åŸŸ --- */
        .dashboard {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 1000px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .board-card {
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid transparent;
        }

        .board-target {
            border-color: var(--secondary-color);
            background-color: #fff8e1;
        }

        .board-current {
            border-color: var(--primary-color);
            background-color: #e8f5e9;
            position: relative;
        }

        .board-title {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .board-data {
            font-size: 1.5rem;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        /* ç›®æ¨™å€çš„ç´…è‰²æ•¸å­—æ¨£å¼ */
        .target-number {
            color: #d32f2f; /* ç´…è‰² */
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
        }

        /* é»‘è‰²ç¿»ç‰Œæ•¸å­—æ¨£å¼ (ç”¨æ–¼å„€è¡¨æ¿èˆ‡ä½œç­”å€) */
        .flip-number, .answer-display {
            background: var(--number-bg);
            color: var(--number-text);
            padding: 5px 0; /* èª¿æ•´å…§è· */
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.8rem;
            width: 70px; /* å›ºå®šå¯¬åº¦ï¼Œç¢ºä¿ä¸Šä¸‹ä¸€è‡´ */
            text-align: center;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: none;
        }

        /* --- éŠæˆ²ä¸»å€åŸŸ --- */
        .game-area {
            display: flex;
            gap: 15px;
            width: 100%;
            max-width: 1100px;
            align-items: stretch;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* å·¦å´æ§åˆ¶ */
        .side-panel {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-width: 120px;
            justify-content: center;
        }

        .control-group {
            text-align: center;
        }

        .btn-circle {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .btn-circle:active { transform: scale(0.9); }
        .btn-plus { background: var(--primary-color); color: white; }
        .btn-minus { background: var(--secondary-color); color: white; }

        .btn-text {
            display: block;
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            background: #ddd;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-text:hover { background: #ccc; }

        /* ä¸­å¤®æŸµæ¬„ */
        .fence-container {
            flex: 2;
            min-width: 320px;
            background: #8d6e63;
            padding: 15px;
            border-radius: 15px;
            border: 8px solid #5d4037;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }

        .fence-row {
            flex: 1;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            align-content: center;
            gap: 5px;
            min-height: 120px;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .fence-row::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            opacity: 0.1;
            pointer-events: none;
        }
        #rowChicken::before { content: 'ğŸ”'; }
        #rowRabbit::before { content: 'ğŸ‡'; }

        .animal-item {
            font-size: 2.8rem;
            animation: bounceIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1;
            user-select: none;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        .btn-clear-abs {
            position: absolute;
            top: -20px;
            right: -10px;
            background: var(--danger-color);
            color: white;
            border: 2px solid white;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 10;
            font-weight: bold;
        }

        /* å³å´äº¤æ›å€ */
        .swap-panel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            min-width: 180px;
        }

        .btn-swap {
            padding: 15px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn-swap:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 rgba(0,0,0,0.2);
        }

        .swap-c-to-r {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 2px solid #ff9800;
            color: #e65100;
        }
        
        .swap-r-to-c {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #4caf50;
            color: #1b5e20;
        }

        .swap-icon { font-size: 1.8rem; }
        .swap-tag { 
            background: rgba(0,0,0,0.1); 
            padding: 2px 8px; 
            border-radius: 10px; 
            font-size: 0.9rem;
        }

        /* --- ä¸‹æ–¹ä½œç­”å€ --- */
        .answer-area {
            background: white;
            margin-top: 25px;
            padding: 20px 40px;
            border-radius: 50px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .answer-group {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-submit {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 40px;
            font-size: 1.4rem;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
            font-weight: bold;
        }

        /* æµ®å‹•é›²æœµç‰¹æ•ˆ */
        .floating-cloud {
            position: absolute;
            background: white;
            color: #333;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 1.1rem;
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            white-space: pre; /* æ”¯æ´ \n æ›è¡Œ */
            text-align: center;
            line-height: 1.4;
        }
        .floating-cloud::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            margin-left: -8px;
            border-width: 8px 8px 0;
            border-style: solid;
            border-color: #333 transparent;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.8); opacity: 0; }
            20% { transform: translateY(-30px) scale(1.1); opacity: 1; }
            100% { transform: translateY(-80px) scale(0.9); opacity: 0; }
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .feedback-card {
            background: white; padding: 40px; border-radius: 20px;
            text-align: center; animation: popIn 0.3s;
        }
        .btn-retry, .btn-play-again {
            margin: 10px; padding: 10px 25px; border: none; border-radius: 8px;
            font-size: 1.2rem; cursor: pointer; color: white;
        }
        .btn-retry { background: #757575; }
        .btn-play-again { background: var(--primary-color); }

    </style>
</head>
<body>

    <h1>ğŸ”é›å…”åŒç± å¤§ä½œæˆ°ğŸ‡</h1>

    <div class="dashboard">
        <div class="board-card board-target">
            <div class="board-title">ç›®æ¨™</div>
            <div class="board-data">
                <span>ç¸½å‹•ç‰©æ•¸: <span class="target-number" id="targetTotal">0</span></span>
                <span>/</span>
                <span>ç¸½è…³æ•¸: <span class="target-number" id="targetLegs">0</span></span>
            </div>
        </div>

        <div class="board-card board-current">
            <div class="board-title">ç›®å‰æ•¸é‡</div>
            <div class="board-data">
                <div>å‹•ç‰© <span class="flip-number" id="currentTotal">0</span> éš»</div>
                <div>è…³ <span class="flip-number" id="currentLegs">0</span> éš»</div>
            </div>
        </div>
    </div>

    <div class="game-area">
        
        <div class="side-panel">
            <div class="control-group">
                <div style="font-size: 2rem;">ğŸ”</div>
                <div>
                    <button class="btn-circle btn-plus" onclick="updateAnimals('chicken', 1)">+</button>
                    <button class="btn-circle btn-minus" onclick="updateAnimals('chicken', -1)">-</button>
                </div>
                <button class="btn-text" onclick="fillAll('chicken')">å…¨æ”¾é›</button>
            </div>
            <hr style="width:80%; border:1px dashed #ccc;">
            <div class="control-group">
                <div style="font-size: 2rem;">ğŸ‡</div>
                <div>
                    <button class="btn-circle btn-plus" onclick="updateAnimals('rabbit', 1)">+</button>
                    <button class="btn-circle btn-minus" onclick="updateAnimals('rabbit', -1)">-</button>
                </div>
                <button class="btn-text" onclick="fillAll('rabbit')">å…¨æ”¾å…”</button>
            </div>
        </div>

        <div class="fence-container">
            <button class="btn-clear-abs" onclick="clearFence()">ğŸ—‘ï¸ æ¸…ç©º</button>
            
            <div class="fence-row" id="rowChicken"></div>
            
            <div class="fence-row" id="rowRabbit"></div>

            <div id="animationAnchor" style="position:absolute; top:50%; left:50%; width:0; height:0;"></div>
        </div>

        <div class="swap-panel">
            <button class="btn-swap swap-c-to-r" onclick="swapAnimal('c2r')">
                <span class="swap-icon">ğŸ” â¡ ğŸ‡</span>
                <span>æŠŠé›æ›æˆå…”</span>
                <span class="swap-tag">è…³æ•¸ +2</span>
            </button>

            <button class="btn-swap swap-r-to-c" onclick="swapAnimal('r2c')">
                <span class="swap-icon">ğŸ‡ â¡ ğŸ”</span>
                <span>æŠŠå…”æ›æˆé›</span>
                <span class="swap-tag">è…³æ•¸ -2</span>
            </button>
        </div>

    </div>

    <div class="answer-area">
        <div class="answer-group">
            é› <input type="text" id="ansChicken" class="answer-display" readonly value="0"> éš»
        </div>
        <div class="answer-group">
            å…” <input type="text" id="ansRabbit" class="answer-display" readonly value="0"> éš»
        </div>
        <button class="btn-submit" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
    </div>

    <div class="overlay" id="feedbackOverlay">
        <div class="feedback-card">
            <div id="fbIcon" style="font-size: 6rem;"></div>
            <h2 id="fbTitle" style="margin: 10px 0;"></h2>
            <p id="fbMsg" style="font-size: 1.2rem; color: #666;"></p>
            <div id="fbBtns"></div>
        </div>
    </div>

    <script>
        // --- éŠæˆ²è®Šæ•¸ ---
        let targetC = 0; // é¡Œç›®é›
        let targetR = 0; // é¡Œç›®å…”
        let targetTotal = 0; // é¡Œç›®ç¸½éš»æ•¸

        let currentC = 0; // æŸµæ¬„é›
        let currentR = 0; // æŸµæ¬„å…”

        // --- åˆå§‹åŒ– ---
        function initGame() {
            // éš¨æ©Ÿå‡ºé¡Œ (ç¸½æ•¸æ§åˆ¶åœ¨ 5-12 éš»)
            targetC = Math.floor(Math.random() * 8) + 1; 
            targetR = Math.floor(Math.random() * 8) + 1;
            targetTotal = targetC + targetR;
            let targetLegs = (targetC * 2) + (targetR * 4);

            // æ›´æ–°é¡Œç›®é¢æ¿
            document.getElementById('targetTotal').textContent = targetTotal;
            document.getElementById('targetLegs').textContent = targetLegs;

            // æ¸…ç©ºæŸµæ¬„
            currentC = 0;
            currentR = 0;
            renderAll();
            hideOverlay();
        }

        // --- æ ¸å¿ƒæ“ä½œé‚è¼¯ ---

        // 1. åŸºç¤å¢æ¸› (+/-)
        function updateAnimals(type, change) {
            if (change > 0 && (currentC + currentR) >= targetTotal) {
                showToast();
                return;
            }

            let prevC = currentC;
            let prevR = currentR;

            if (type === 'chicken') {
                currentC += change;
                if (currentC < 0) currentC = 0;
            } else {
                currentR += change;
                if (currentR < 0) currentR = 0;
            }

            let diffC = currentC - prevC;
            let diffR = currentR - prevR;
            if (diffC !== 0 || diffR !== 0) {
                renderAll();
                triggerCloudAnimation(diffC + diffR, (diffC*2 + diffR*4));
            }
        }

        // 2. å…¨éƒ¨å¡«æ»¿
        function fillAll(type) {
            let prevC = currentC;
            let prevR = currentR;

            if (type === 'chicken') {
                currentC = targetTotal;
                currentR = 0;
            } else {
                currentC = 0;
                currentR = targetTotal;
            }

            renderAll();
            
            let diffC = currentC - prevC;
            let diffR = currentR - prevR;
            triggerCloudAnimation(diffC + diffR, (diffC*2 + diffR*4));
        }

        // 3. äº¤æ›é‚è¼¯
        function swapAnimal(mode) {
            if (mode === 'c2r') {
                // é›æ›å…”
                if (currentC > 0) {
                    currentC--;
                    currentR++;
                    renderAll();
                    // é€™è£¡çš„ diffCount ç‚º 0ï¼ŒtriggerCloudAnimation æœƒè‡ªå‹•éš±è—ç¬¬ä¸€è¡Œ
                    triggerCloudAnimation(0, 2); 
                } else {
                    showToast();
                }
            } else if (mode === 'r2c') {
                // å…”æ›é›
                if (currentR > 0) {
                    currentR--;
                    currentC++;
                    renderAll();
                    // é€™è£¡çš„ diffCount ç‚º 0
                    triggerCloudAnimation(0, -2);
                } else {
                    showToast();
                }
            }
        }

        function clearFence() {
            currentC = 0;
            currentR = 0;
            renderAll();
        }

        // --- ç•«é¢æ¸²æŸ“ ---
        function renderAll() {
            // æ¸²æŸ“é›
            const rowC = document.getElementById('rowChicken');
            rowC.innerHTML = '';
            for(let i=0; i<currentC; i++) {
                let span = document.createElement('div');
                span.className = 'animal-item';
                span.textContent = 'ğŸ”';
                rowC.appendChild(span);
            }

            // æ¸²æŸ“å…”
            const rowR = document.getElementById('rowRabbit');
            rowR.innerHTML = '';
            for(let i=0; i<currentR; i++) {
                let span = document.createElement('div');
                span.className = 'animal-item';
                span.textContent = 'ğŸ‡';
                rowR.appendChild(span);
            }

            // æ›´æ–°å„€è¡¨æ¿
            let total = currentC + currentR;
            let legs = (currentC * 2) + (currentR * 4);
            document.getElementById('currentTotal').textContent = total;
            document.getElementById('currentLegs').textContent = legs;

            // æ›´æ–°ä½œç­”å€
            document.getElementById('ansChicken').value = currentC;
            document.getElementById('ansRabbit').value = currentR;
        }

        // --- ç‰¹æ•ˆèˆ‡å›é¥‹ ---
        
        // é›²æœµå‹•ç•« (å„ªåŒ–ç‰ˆï¼šæ ¹æ“šæ•¸å€¼æ±ºå®šé¡¯ç¤ºè¡Œæ•¸)
        function triggerCloudAnimation(diffCount, diffLegs) {
            if (diffCount === 0 && diffLegs === 0) return;

            const anchor = document.getElementById('animationAnchor');
            const cloud = document.createElement('div');
            cloud.className = 'floating-cloud';
            
            let displayText = "";

            // åªæœ‰ç•¶å‹•ç‰©æ•¸é‡æœ‰è®ŠåŒ–æ™‚ï¼Œæ‰é¡¯ç¤ºç¬¬ä¸€è¡Œ
            if (diffCount !== 0) {
                let animalSign = diffCount > 0 ? '+' : '';
                displayText += `å‹•ç‰© ${animalSign}${diffCount}`;
            }

            // åªæœ‰ç•¶è…³æ•¸æœ‰è®ŠåŒ–æ™‚ï¼Œæ‰é¡¯ç¤ºç¬¬äºŒè¡Œ
            if (diffLegs !== 0) {
                if (displayText !== "") displayText += "\n"; // å¦‚æœæœ‰ç¬¬ä¸€è¡Œï¼ŒåŠ æ›è¡Œç¬¦è™Ÿ
                let legSign = diffLegs > 0 ? '+' : '';
                displayText += `è…³ ${legSign}${diffLegs}`;
            }

            cloud.textContent = displayText;
            
            // è¨­å®šé¡è‰² (ä»¥è…³ç‚ºä¸»è¦é¡è‰²æŒ‡ç¤ºï¼Œè‹¥æ²’è®Šå‰‡çœ‹å‹•ç‰©)
            if (diffLegs > 0) cloud.style.color = '#2e7d32'; 
            else if (diffLegs < 0) cloud.style.color = '#c62828';
            else cloud.style.color = '#333';

            // éš¨æ©Ÿä½ç§»
            let randX = Math.floor(Math.random()*40 - 20);
            cloud.style.transform = `translate(${randX}px, 0)`;

            anchor.appendChild(cloud);
            
            // CSSå‹•ç•«
            cloud.style.animation = "floatUp 1.5s ease-out forwards";
            
            setTimeout(() => cloud.remove(), 1500);
        }

        function showToast() {
            const board = document.querySelector('.board-current');
            board.style.borderColor = '#f44336';
            setTimeout(() => board.style.borderColor = '#4CAF50', 500);
        }

        // --- æª¢æŸ¥ç­”æ¡ˆ ---
        function checkAnswer() {
            const overlay = document.getElementById('feedbackOverlay');
            const icon = document.getElementById('fbIcon');
            const title = document.getElementById('fbTitle');
            const msg = document.getElementById('fbMsg');
            const btns = document.getElementById('fbBtns');

            overlay.style.display = 'flex';
            btns.innerHTML = '';

            if (currentC === targetC && currentR === targetR) {
                icon.textContent = 'â­•';
                title.textContent = 'ç­”å°äº†ï¼å¤ªç¥å•¦ï¼';
                title.style.color = '#4CAF50';
                msg.textContent = `å®Œç¾çš„åˆ†é…ï¼š${currentC} éš»é›ï¼Œ${currentR} éš»å…”ã€‚`;
                
                const btnNext = document.createElement('button');
                btnNext.textContent = 'å†ç©ä¸€æ¬¡';
                btnNext.className = 'btn-play-again';
                btnNext.onclick = initGame;
                btns.appendChild(btnNext);
            } else {
                icon.textContent = 'âŒ';
                title.textContent = 'é‚„å·®ä¸€é»é»å–”ï¼';
                title.style.color = '#f44336';
                
                let currentTotal = currentC + currentR;
                let currentLegs = (currentC * 2) + (currentR * 4);
                let targetLegs = (targetC * 2) + (targetR * 4);

                if (currentTotal !== targetTotal) {
                    msg.textContent = `é¡Œç›®èªªæ˜¯ ${targetTotal} éš»å‹•ç‰©ï¼Œä½†ç›®å‰åªæœ‰ ${currentTotal} éš»å–”ï¼`;
                } else {
                    let diff = targetLegs - currentLegs;
                    if (diff > 0) {
                        msg.textContent = `å‹•ç‰©æ•¸é‡å°äº†ï¼Œä½†æ˜¯è…³å°‘äº† ${diff} éš»ï¼è©¦è©¦çœ‹æŠŠé›æ›æˆå…”å­ï¼Ÿ`;
                    } else {
                        msg.textContent = `å‹•ç‰©æ•¸é‡å°äº†ï¼Œä½†æ˜¯è…³å¤šäº† ${Math.abs(diff)} éš»ï¼è©¦è©¦çœ‹æŠŠå…”å­æ›æˆé›ï¼Ÿ`;
                    }
                }

                const btnRetry = document.createElement('button');
                btnRetry.textContent = 'ç¹¼çºŒèª¿æ•´';
                btnRetry.className = 'btn-retry';
                btnRetry.onclick = hideOverlay;
                btns.appendChild(btnRetry);
            }
        }

        function hideOverlay() {
            document.getElementById('feedbackOverlay').style.display = 'none';
        }

        window.onload = initGame;
    </script>
</body>
</html>